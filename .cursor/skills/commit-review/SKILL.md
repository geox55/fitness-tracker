---
name: commit-review
description: Анализирует один или несколько коммитов в git-репозитории, оценивает качество commit message и релевантность изменений задаче или фиче. Использовать, когда пользователь просит ревью недавних коммитов (например, последних 3), их уместности, связности или хочет рекомендации по улучшению истории коммитов.
---

# Commit Review

## Purpose

Этот skill помогает проводить **структурированное ревью недавних коммитов** в репозитории:

- **Оценивает качество commit message** (структура, информативность, стиль).
- **Проверяет релевантность изменений** заявленной задаче/фиче.
- **Анализирует группировку коммитов** (логичность, размер, шумовые правки).
- Выдаёт **структурированный отчёт по секциям** для каждого коммита и итоговые рекомендации.

Использовать этот skill, когда пользователь говорит что-то вроде:

- «Сделай ревью **последних 3 коммитов**».
- «Посмотри, насколько **релевантны** эти коммиты задаче».
- «Оцени, нормально ли сгруппированы мои коммиты».

Если пользователь не указал количество коммитов, по умолчанию анализируй **последние 3 коммита** и явно упоминай это в ответе.

---

## Input

При применении этого skill учитывай следующие варианты входа:

- **Явно указанное количество коммитов**:
  - Примеры: «последние 3 коммита», «review last 5 commits».
- **Без явного количества**:
  - Используй значение по умолчанию: **N = 3**.
- **Дополнительный контекст задачи/фичи (опционально)**:
  - Краткое текстовое описание (например, текст тикета или фичи).
  - Ссылки на спецификацию/документацию (если есть).
- **Приложенные diff/списки файлов (опционально)**:
  - Если пользователь уже приложил diff (`git show`, `git log`, `git diff`) или список файлов, используй эти данные напрямую и **избегай лишних команд**.

Всегда фиксируй в ответе:

- Какое количество коммитов было проанализировано.
- Был ли использован дополнительный контекст задачи.

---

## Data Collection

Если пользователь не приложил данные по коммитам, используй `Shell` и git-команды только в текущем репозитории, без смены веток:

- **Общий обзор последних N коммитов**:
  - `git log -n N --oneline`
- **Детальный анализ каждого коммита**:
  - Для коммита `<SHA>`:
    - `git show --stat --summary <SHA>` — обзор изменений и файлов.
    - При необходимости: `git diff <SHA~1> <SHA>` — полный diff.

Рекомендации:

- Не дублируй команды, если пользователь уже дал их вывод.
- Если N велико и команда вернёт слишком большой diff, фокусируйся на:
  - именах файлов и их путях;
  - заголовках/частях изменений, которые наиболее критичны для логики и релевантности.

---

## Evaluation Criteria

### 1. Commit Messages

При оценке commit message учитывай:

- **Структуру и формат**:
  - Желательно, но не обязательно, следование [Conventional Commits](https://www.conventionalcommits.org/) (в этом репо уже есть отдельный skill `git-commits-workflow`, который помогает формировать такие сообщения).
  - Читаемость заголовка: понятный, по делу, без «мусора».
- **Информативность**:
  - Понятно ли, **что** сделано и **зачем**.
  - Можно ли по одному коммиту примерно понять суть изменений без просмотра diff.
- **Стиль**:
  - Избегание шуточных, неинформативных или слишком общих сообщений (`stuff`, `fix`, `update`, `wip`, и т.п.).
  - Отсутствие приватной/чувствительной информации (пароли, токены, личные данные).

Когда уместно, можешь ссылаться на практики из `git-commits-workflow`, но **не дублируй** весь его контент.

### 2. Relevance to Task/Feature

Под «релевантностью» понимается, насколько изменения в коммите соответствуют заявленной цели (задаче, фиче, багфиксу):

- **Вопросы для оценки**:
  - Соответствуют ли изменённые файлы и логика тому, что описано в задаче/контексте пользователя.
  - Есть ли изменения, которые выглядят **шумовыми**:
    - массовое форматирование, не связанное с задачей;
    - несвязанные переименования, перемещения файлов;
    - правки, которые логически относятся к другой фиче.
  - Не слишком ли велик коммит по объёму для одной логической единицы работы.
- **Оценивай релевантность** качественно, например:
  - `High` — почти все изменения напрямую связаны с задачей.
  - `Medium` — есть часть шумовых правок или смешение задач.
  - `Low` — значительная часть изменений не относится к описанной цели.

Если пользователь не дал явный контекст задачи, оценивай релевантность **по внутренней связности** изменений (между файлами и логикой).

### 3. Commit Grouping

Анализируй, насколько логично сгруппированы изменения:

- **Хорошая группировка**:
  - Один коммит — одна фича, один фикс или один рефакторинг.
  - Небольшое количество файлов, связанных одной задачей.
- **Подозрительные случаи**:
  - Смешение **разных типов изменений** в одном коммите:
    - новая фича + массовый рефакторинг;
    - фикс бага + независимые изменения в других модулях.
  - Очень крупные коммиты, которые можно (и стоит) разбить.
  - Частые «WIP»/«tmp» коммиты без ясной задачи.

В рекомендациях предлагай:

- Где стоит **разбить** коммит на 2–3 меньших.
- Где можно было бы **объединить** несколько мелких коммитов.

---

## Output Format

Структурируй ответ по следующему шаблону.

### 1. Overview

Краткое резюме по всей группе проанализированных коммитов:

- Сколько коммитов рассмотрено.
- Общий уровень качества сообщений.
- Общая оценка релевантности и группировки.

Формат (пример):

```markdown
## Commit review — overview

- Analyzed commits: 3 (HEAD..HEAD~2)
- Overall message quality: good, but 1 commit has vague summary.
- Overall relevance: mostly high, есть немного шумового рефакторинга.
```

### 2. Per-Commit Analysis

Для **каждого коммита** сделай отдельный подпункт в одном и том же формате:

```markdown
### Commit <short-sha> — <first line of message>

**Summary**
- [кратко опиши, что делает этот коммит по сути]

**Problems**
- [перечисли проблемы/риски, если есть]
- [если критики нет, явно укажи, что заметных проблем не найдено]

**Suggestions**
- [конкретные рекомендации по улучшению commit message]
- [рекомендации по разбиению или объединению коммитов]
- [советы по избежанию шумовых изменений в будущем]

**Relevance/Grouping**
- Relevance: High | Medium | Low
- Grouping: [комментарий по размеру и логике группировки]
```

Старайся писать кратко, но по делу. Если коммит идеален, всё равно явно отметь это в секциях `Problems` и `Suggestions`.

### 3. Overall Recommendations

В конце дай общий сводный блок:

```markdown
## Overall recommendations

- [1–3 ключевых рекомендации по всей серии коммитов]
- [что улучшить в стиле сообщений/группировке коммитов в будущем]
```

Примеры общих рекомендаций:

- «Разбивать слишком крупные коммиты на логические части».
- «Уточнять заголовки коммитов, чтобы отражать поведение, а не только внутренние детали реализации».
- «Выносить массовое форматирование в отдельные `style` или `refactor` коммиты».

---

## Usage Examples

### Example 1 — Default last 3 commits

**User request**

> Сделай ревью моих последних коммитов и скажи, нормально ли они сгруппированы.

**Agent behavior**

1. Понимает, что количество не указано → использует `N = 3`.
2. Запрашивает данные:
   - `git log -n 3 --oneline`
   - Для каждого SHA — `git show --stat --summary <SHA>` (и при необходимости `git diff <SHA~1> <SHA>`).
3. Проводит оценку по критериям:
   - качество commit message;
   - релевантность изменений;
   - группировка.
4. Возвращает ответ в формате:
   - `Overview` → `Per-Commit Analysis` → `Overall Recommendations`.

### Example 2 — With explicit N and feature context

**User request**

> /create-skill Проверь, пожалуйста, последние 5 коммитов и их релевантность задаче по обновлению логики тренировок. Задача: упростить создание и редактирование тренировок в мобильном UI.

**Agent behavior**

1. Фиксирует: `N = 5`, задача — «упростить создание и редактирование тренировок в мобильном UI».
2. Получает данные по 5 последним коммитам (или использует уже предоставленные диффы).
3. Для каждого коммита оценивает:
   - насколько изменения блоков кода и файлов связаны с указанной задачей;
   - нет ли коммитов, которые относятся к другим областям (например, backend, инфраструктура, не связанная с текущей задачей).
4. В секции `Relevance/Grouping` даёт явную оценку `High/Medium/Low` и комментарии о том, какие коммиты выглядят «лишними» или избыточно крупными.

---

## Triggers

Автоматически применяй этот skill, когда:

- Пользователь упоминает:
  - «последние N коммитов»;
  - «ревью коммитов» / «review commits»;
  - «оценить релевантность коммитов»;
  - «git history», «git log», «посмотри историю».
- Пользователь просит:
  - оценить, «нормально ли» сгруппированы коммиты;
  - указать, «какие коммиты лишние»;
  - подсказать, как улучшить историю коммитов.

Если точно не ясно, подходит ли этот skill, но запрос связан с **оценкой нескольких недавних коммитов**, **по умолчанию** считай, что skill уместен и можно его применить.

